## vue-cli原理### 教你怎么搭建一个类似vue-cli的炫酷安装工具#### 原理及准备工作> 用过vue的同学一定对vue-cli不陌生，vue-cli是vue全家桶的一部分，俗称脚手架。是vue官方给我们提供的一个方便的开发工具。在使用vue-cli非常简单，只需要使用npm install vue-cli -g安装即可，然后只要运行vue init按照提示依次安装就OK了。> 这么简单的操作步骤，也是vue艺术所在，让简单易用成为vue的座右铭。此时，你肯定也和我一样，也想让自己的项目能这样安装，那又该怎么做呢？如果你学过一点儿C语言（很多后端语言都有类似的例子），通常会写过一个题目，这个题目开始让你在命令行中输入几个数字，然后按下enter，程序去执行最后打印出结果。> 这种在命令行停下来等待输入，然后将输入的内容作为参数放到程序中去运行，最后给出结果的模式不就是vue-cli在运行vue init时候的流程吗。其实思想是一样的，只不过这里我们用的是node来完成的。如果用node提供的api来写，可以使用process模块操作。但是，这里使用一个npm成熟的模块——commander。具体该模块的使用方法可以参见我另一篇博客——"命令行那些事儿"，有详细的介绍。#### 认识npm的bin> bin字段一般场景下使用不多，但其实这个字段很有用。bin字段可以帮助我们在执行npm install -g模块的时候添加PATH（PATH在系统中的作用就不赘述了，不了解的可以去百度一下）。注意这种方式是通过npm来注入的，因此必须是npm包才会有效。vue-cli本身就是通过npm来安装的，这也是bin能发挥作用的原因；>macOS 默认情况下，npm全局安装的包在路径"/usr/local/bin/lib"下；> 在package.json中配置了bin字段，可以允许我们在npm包根目录下添加一个bin文件夹。该文件下存储一些命令行要执行的脚本文件；<img src="./assets/binimg.png"/>```注意：bin下写的脚本要想起作用，需要在代码的最开始添加一行代码：#!/usr/bin/env node```> #!/usr/bin/env node 是在告诉计算机当前的代码运行环境是node，如果不写这段代码，那么计算机将不清楚这段代码的执行环境是什么。#### vue-cli的设计思路> vue-cli本身随着后期的迭代，具有很多人性化的设计方案，我们这里就不分析其中的源码了，感兴趣的可以去官方的GitHub去看。这里主要介绍一下vue-cli的思路；其实说起来也很简单，无非就是两步：1. 和用户进行互动，获取项目设置的必要参数；2. 从github仓库下载代码到本地；> vue-cli其实还不单单做了这两件事，操作过vue-cli的同学可以发现，vue-cli提供了例如eslint、karam等可选内容的安装，也就是说，你可以按照自己的需要去定制脚手架的一些附加功能。这个特点在稍后我们也会进行分析；先来分析以上基本的两点：#### 如何设计命令行交互？>上面已经提到了部分内容，其实思路就是在npm安装的时候，首先写一个文件，比如vue-init，这个文件放到bin关键字中，这样就可以在npm安装完毕后将这个文件以命令行的形式注入进去。然后需要做的就是在这个文件vue-init安装完毕后，就可以执行vue init命令，此时每次执行都会和用户有一个交互操作，这个主要采用process模块的stdin输入流模块，类似C语言的输入流方法。只不过在node端，需要需要利用stdin的一个data事件去监听用户输入内容，并将获取用户在命令行的输入内容。此时就完成了和用户的互动，并可以拿到用户的输入内容。> vue-cli没有自己去用node去造轮子，而是在这里使用了两个模块：[commander模块](https://github.com/tj/commander.js)和[Inquirer模块](https://github.com/SBoudrias/Inquirer.js)；其中commander模块完成的就是读取命令行参数，并可以完成一些常用的help设置（类似npm help）。Inquirer模块主要完成的是命令行的交互读取，可以将读取到的命令行参数作为自己的参数返回，在回调函数中去反馈处理；详细的使用方法可以参见我的另外两篇博客；#### 如何从github仓库拉取代码？